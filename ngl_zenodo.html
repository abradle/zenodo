<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
</head>
<body>

<script>
    // Just fix these for each page
    var data_base = "JMJD2DA-x336_event2"//"https://zenodo.org/record/239039/files/JMJD2DA-x395_event1"
    // Then add the extensions
    var pdb_file = data_base+".pdb"
    var map_file = data_base+".ccp4"
    // Not sure if this is correct
    var ligSele = "LIG"
</script>

    <script src="ngl.js"></script>
    <script>
var sview;        
document.addEventListener( "DOMContentLoaded", function() {
    var stage = new NGL.Stage("viewport");

    Promise.all([
        stage.loadFile(pdb_file),
        stage.loadFile(map_file)
    ]).then(function (oList) {

        var comp = oList[0];
        var o = oList[1];
        var sele = new NGL.Selection(ligSele);
        comp.addRepresentation("cartoon");
        comp.addRepresentation("ball+stick",{sele:ligSele});
        var sview = comp.structure.getView(sele);
        o.addRepresentation( "surface", {
            wireframe: true,
            color: "skyblue",
            boxSize: 10
            } );

        var position = new NGL.Vector3();
        function getCenterArray(){
                var target = stage.viewer.controls.target;
                var group = stage.viewer.rotationGroup.position;
                position.copy( group ).negate().add( target );
                return position.toArray()
            }

        var sphereBuffer = new NGL.SphereBuffer(
                new Float32Array( getCenterArray() ),
                new Float32Array( [ 1, 0, 0 ] ),
                new Float32Array( [ 1 ] ),
                undefined,
                { disableImpostor: true }
            );
        o.addBufferRepresentation( sphereBuffer, { flatShaded: true } );
        stage.viewer.controls.addEventListener(
            'change', function(){
                sphereBuffer.setAttributes( {
                    "position": getCenterArray(),
                } );
            }
        );
        comp.centerView(true, ligSele);
    });
});


    </script>
    <div id="viewport" style="width:400px; height:300px;"></div>
</body>
</html>
